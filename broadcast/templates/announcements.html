{% load static %}

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Material Design for Bootstrap</title>
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
  <!-- MD5 bootstrap -->
  <link href="{% static 'mdb5-free-standard/css/mdb.min.css' %}" rel="stylesheet" type="text/css"/>
</head>
<body>
 	<div class="container mt-5">
        <h2>Message Broadcasting Form</h2>
        <form id="message-form">
			{% csrf_token %}
            <div class="form-group">
                <label for="subject">Subject</label>
                <input type="text" class="form-control" id="subject" name="subject" required>
            </div>
            <div class="form-group">
                <label for="message">Message</label>
                <textarea class="form-control" id="message" name="message" rows="4" required></textarea>
            </div>
            <div class="form-group">
                <label for="communication-mode">Mode of Communication</label>
                <select class="form-control" id="communication-mode" name="communication_mode">
                    <option value="sms">SMS</option>
                    <option value="email">Email</option>
                    <option value="whatsapp">WhatsApp</option>
                </select>
            </div>
            <div class="form-group">
                <label for="employee-group">Select Employee Group</label>
                <select class="form-control" id="employee-group" name="employee_group">
					<option value="all">All employees</option>
                    <option value="salary-scale-1">Salary Scale C1</option>
                    <option value="salary-scale-2">Salary Scale D2</option>
                    <option value="salary-scale-3">Salary Scale E3</option>
                    <!-- Add more options for different groups as needed -->
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Send Message</button>
        </form>
    </div>
  
  <!-- MD5 js -->
  <script src="{% static 'mdb5-free-standard/js/mdb.min.js' %}"></script>
  <script src="{% static 'js/jquery.min.js' %}"></script>
  <script>
        $(document).ready(function() {
            $("#message-form").submit(function(e) {
                e.preventDefault();
                var subject = $("#subject").val();
                var message = $("#message").val();
                var communicationMode = $("#communication-mode").val();
                var employeeGroup = $("#employee-group").val();

                // Send the form data to your API endpoint using AJAX
                $.ajax({
                    url: "/send-announcement/",  // Update the URL to match your endpoint
                    type: "POST",
                    data: {
                        subject: subject,
                        message: message,
                        mode: communicationMode,
                        group: employeeGroup
                    },
                    headers: {
                        "X-CSRFToken": getCookie("csrftoken")
                    },
                    success: function(data) {
                        alert("Message sent successfully!");
                        // You can also handle success as per your app's requirements.
                    },
                    error: function(xhr, textStatus, errorThrown) {
                        alert("Error: Message not sent. Please try again.");
                        // You can handle errors as per your app's requirements.
                    }
                });
            });
        });
        
        // Function to get the CSRF token cookie value
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== "") {
                var cookies = document.cookie.split(";");
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    if (cookie.substring(0, name.length + 1) === name + "=") {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
   </script>
</body>
</html>
